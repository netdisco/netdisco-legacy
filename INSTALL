NAME

    Netdisco INSTALL -- Instructions for setting up Netdisco application.

AUTHOR

    Max Baker "max@warped.org"

SUPPORT

    Netdisco is hosted by Source Forge.

    Please use the "netdisco-users" mailing list for all problems and
    comments.

    http://lists.sourceforge.net/lists/listinfo/netdisco-users

    Please use the Bug interface from Source Forge page at :

    http://sourceforge.net/projects/netdisco

REQUIREMENTS

    Netdisco is built using lots of fine Open-Source tools:

    * Perl
        5.6.1 and newer advised

    * Perl Modules
        Listed below

    * Net-SNMP
        5.0.2 and newer advised

    * PostgreSQL
        Developed under version 7.3

    * Mason
        1.16 or newer required

    * Apache
        1.3.x advised, Version 2.x not supported by mod_perl.

    * mod_perl
        Version to match Apache

    * GraphViz
    See *INSTALL* below for details on how to retrieve and install each one.

  OS

    Netdisco was developed on a BSD system but should work on any system
    that Postgres, Perl, Apache, and Net-SNMP run on. Linux is a sure bet.
    Windows will take a little bit of massaging but should be possible.

INSTALL

    This is not a terribly easy install. If you aren't comfortable
    installing programs from source and using a text editor, get some help.
    Hopefully this will all be rolled up into an install script by the time
    Netdisco comes out of Beta.

  1. Download and Un-archive Netdisco

    Get the newest version from http://www.netdisco.org.

        tar xvfz netdisco-x.xx.tar.gz    

    Create a directory for Netdisco

        mkdir /usr/local/netdisco

    Move files to that dir

        mv netdisco-x.xx/* /usr/local/netdisco

  2. Create a Unix User/Group for Netdisco

    Create a user and group named "netdisco"

    Give this user permission to the files:

        chown -R netdisco.netdisco /usr/local/netdisco

  3. Add Unix Administrators to Netdisco Group

    Once Netdisco is up and running most administration can be done from the
    Web interface. Whoever will be doing the back-end administration will
    need to have write access and will need write access on Netdisco's
    files.

    Add the unix account names of administrators that will modify the source
    code or use the command line interface interface to the "netdisco" group
    in /etc/groups.

  4. PostgreSQL

    Netdisco's settings in PostgreSQL are

     Database User    : netdisco
     Database Name    : netdisco
     Database Password: you choose it

    Follow these steps to setup Netdisco in PostgreSQL.

    i. Create Database.
        As root or the database user pgsql run "sql/pg_init" to create the
        database and user for Netdisco. The password you will be asked for
        twice is the new password for the database user you are creating.
        This is the same password you will be putting in
        netdisco_apache.conf and in netdisco.conf.

            cd /usr/local/netdisco
            sql/pg_init

    ii. Check Settings
        Now as a non-privileged user make sure you can get into the database
        by running "sql/pg_run". Enter the database user password given
        above.

            cd /usr/local/netdisco
            sql/pg_run

    iii. Create Tables
        Once you are sure the database is setup correctly, create the
        database tables with "sql/pg_all". Type in the database user
        password once when prompted.

            cd /usr/local/netdisco
            sql/pg_all

    iv. Permissions
        [Optional] If you have just setup Postgres for the first time you
        may want to change the default permissions in $PG_DATA/pg_hba.conf .

        TODO: More here Later

    v. Optimizations
        [Optional] If you have freshly installed Postgresql then the default
        memory usage should probably be increased for efficiency. See the
        PostgreSQL documentation for postgresql.conf.

  5. Perl Modules and Mason

    Below is a list of required modules for Netdisco, freely available from
    CPAN (http://www.cpan.org). Many of these modules have prerequisite
    modules.

    Use the CPAN module that comes with Perl to install the modules and
    their prerequisites automatically:

        perl -MCPAN -e shell

    install DBI
    install Apache::DBI
    install DBD::Pg
    install Apache::Session
    install HTML::Mason
    install MasonX::Request::WithApacheSession
    install Graph
    install GraphViz (optional)
    install Digest::MD5 (should be built in to perl)
    Some of these you will probably already have installed.

   Perl Location

    If you have Perl installed in "/usr/bin", make sure that netdisco and
    bin/doc_munge have the correct location for Perl listed at the very top
    of the file.

  6. Net-SNMP

    For BSD install Net SNMP with ports :

        cd /usr/ports/net/net-snmp && make install

    For Linux and the rest of the world :

    i. Download Net-SNMP from http://net-snmp.sourceforge.net
        This used to be called ucd-snmp.

    ii. Install Net-SNMP to include Perl module that comes inside the
    distribution.
        When you run "./configure", make sure you add the switch
        "--with-perl-modules"

            ./configure --with-perl-modules
            make 
            make install

        If you already have net-snmp installed, then go to the source
        directory and in the "perl" subdirectory and run "perl Makefile.PL"

            cd /path/to/net-snmp-5.0.x/perl
            perl Makefile.PL
            make
            make install

         ********************************************************************

        DO NOT INSTALL the SNMP:: modules off of CPAN or the NET::SNMP
        module off of CPAN.

         ********************************************************************

        Reread the above line.

        If you have installed the Net-SNMP RPM from Redhat 8, it doesn't
        include the Perl modules. Uninstall it and install a newer version
        by hand.

    iii. Run "snmpconf" and set up your MIB directory.
        (Default /usr/local/share/snmp/mibs)

        Make sure this new snmp.conf lives in /usr/local/share/snmp

   SNMP::Info

    This Perl module is an integral part of Netdisco. It is available from
    http://snmp-info.sourceforge.net. It requires that you have net-snmp
    installed first.

    SNMP::Info holds all the device-specific code to retrieve data from
    network devices via SNMP. A wide variety of Cisco,HP,Bay, and Aironet
    devices are supported. You may need to add support for other devices if
    they do not follow a standard interface. This is not too complex. See
    SNMP::Info for more details.

    You have three different options in installing SNMP::Info

    a. CPAN
            perl -MCPAN -e shell
            install SNMP::Info

    b. From Source
        Download newest version from http://snmp-info.sourceforge.net

            tar xvfz SNMP-Info-0.x.tar.gz 
            cd SNMP-Info-0.x
            perl Makefile.PL
            make install

    c. From CVS
        If you plan to add or change device support in SNMP::Info to
        customize Netdisco to your devices, you should install SNMP::Info
        this way.

            make snmp

        This will create the SNMP/ directory where SNMP::Info will live.
        Periodically you should re-run

            make snmp

        To update to the most current CVS version.

   MIBs

    MIBs are required for SNMP::Info.

    Follow the instructions at http://snmp-info.sourceforge.net for what
    MIBs to install and how to get them.

  7. OUI Database

    The Organizationally Unique Identifier (OUI) database allows Netdisco to
    identify the manufacture of a network card using the first 24 bits of a
    MAC address.

    The database of OUIs is needed by Netdisco and is available from the
    IEEE.

    If you have "lynx" installed you can install the OUI database by:

        cd /usr/local/netdisco
        make oui

    Or do this by hand:

    i. Download oui.txt from http://standards.ieee.org/regauth/oui/
    ii. Run "netdisco -O"
    A note about Make versions. The Makefile is a GNU Make version file. In
    BSD you may have to type "gmake".

  8. GraphViz

    GraphViz is used in the creation of the Network Map.

    To Download:

    i. Download
        For BSD use ports:

            cd /usr/ports/graphics/graphviz && make install

        Others:

        Get the newest version from http://www.graphviz.org/pub/graphviz.
        Unarchive and install.

    ii. True Type Font
        Copy a True Type Font file (.ttf) into the Netdisco directory and
        change "node_font" in netdisco.conf to match.

            cp /path/to/windows/fonts/lucon.ttf /usr/local/netdisco

    iii. Graph Settings
        Review other graph settings in netdisco.conf

    iv. Check Path
        Make sure that neato/twopi is in your path, and/or in the crontab
        path that creates the graphs.

            which twopi
            which neato

    v. Perl Module GraphViz
        Make sure the Graphviz Perl module got installed

            perldoc GraphViz

    [Optional] If for some reason you choose not to install GraphViz, you
    still need to install the Graph module (Perl Modules above). It is used
    in topology calculations.

  9. Setup Apache

    *Apache2* --

    Until mod_perl 2.0 is released as stable, Mason will not run under
    Apache2. Netdisco will not run under Apache2 until that point.

    Install Apache 1.3.x and mod_perl 1.x and mod_ssl
        Netdisco is designed to work in a secure (https) or non-secure
        environment. Due to the security and privacy concerned associated
        with this data, using a secure server is recommended.

        Below is my method if you haven't installed apache and mod_perl
        before. I statically compile mod_perl, and mod_ssl then leave the
        rest of the modules as dynamically loadable objects (DSO).

        i. Download and Unarchive
            Get Apache from http://httpd.apache.org

            Get mod_perl from http://perl.apache.org

            Get mod_ssl from http://www.modssl.org

            Unarchive all three to the same directory, maybe /usr/local/src

        ii. In apache_1.3.x/
             ./configure 

            Sets up the directory scheme.

        iii. In mod_ssl
            For BSD :

            a. cd /usr/ports/devel/mm & make install
            b. cd /usr/ports/security/openssl & make insatll
            c. Setup mod_ssl
                 SSL_BASE=SYSTEM\
                 ./configure \
                    --with-apache=../apache_1.3.x \
                    --disable_rule=SSL_COMPAT

            For other OS's

            Follow the instructions in the INSTALL that comes with "mod_ssl"

             SSL_BASE=/path/to/openssl-0.9.x \
             ./configure \
                --with-apache=../apache_1.3.x \        
                --disable_rule=SSL_COMPAT

        iii. In mod_perl-1.2x/
             /usr/local/bin/perl Makefile.pl \
                    APACHE_SRC=../apache_1.3.x/src \
                    EVERYTHING=1 \
                    DO_HTTPD=1 \
                    USE_APACI=1 \
                    PREP_HTTPD=1

             make

        iv. Back in apache_1.3.x/
             ./configure \
                    --prefix=/usr/local/apache \
                    --enable-module=most \
                    --enable-shared=max \
                    --activate-module=src/modules/perl/libperl.a \
                    --with-perl=/usr/local/bin/perl \
                    --enable-module=ssl
             make
             make certificate
             make install

        v. Back in mod_perl-1.2x/
             make install

    httpd.conf
        Add the following lines in your "httpd.conf".

        Your "httpd.conf" will live in "/usr/local/apache/conf" if you
        installed using my method.

        a. In the Global Section
            Add this line in the end of "httpd.conf" not in a VirtualHost
            section.

                Include /usr/local/netdisco/netdisco_apache.conf

        b. In each VirtualHost
            If you have Virtual Hosts or are setting up a secure server, put
            the following line in each of them that you want Netdisco turned
            on for:

            If you are not using Virtual Hosts, then add this line under the
            *netdisco_apache.conf* line.

                Include /usr/local/netdisco/netdisco_apache_dir.conf

    Mason Data Directory
        Set the mason data directory writable to the apache user that does
        the requests.

        Assuming "nobody" is the user that apache requests run this as
        "root" :

            mkdir /usr/local/netdisco/mason
            chown nobody.netdisco /usr/local/netdisco/mason

        The name of the user is listed in "httpd.conf" under the "User"
        directive.

    Start Apache
            /usr/local/apache/apachebin start

        Go to the webserver and

    Note: Some Linux distributions such as Redhat 6.x install mod_perl as a
    Dynamic Shared Object (DSO). This is known to be unstable, especially
    with Mason. Compile mod_perl statically using the method listed above.

  10. Netdisco Configuration

    netdisco.conf
        Modify netdisco.conf to match your site.

        See README for detailed configuration descriptions.

    netdisco_apache.conf
        Change settings on lines:

            session_user
            session_password
            session_cookie_domain

    netdisco.crontab
        Change "!!center_network_device_here!!" to a network device that is
        well connected to the main segment by CDP.

    Add a user in Netdisco
        This is a user inside the Netdisco database that will be your Web
        Admin User

            /usr/local/netdisco/netdisco -u username

        Add more users from the web "Admin Panel" once Netdisco is up and
        running.

    Make Documentation
        This step is only necessary if you have installed from CVS.

        i. Perl Location
            Make sure that the "POD2TEXT" lines in Makefile point to where
            your Perl binaries are installed.

        ii. Create Docs
             cd /usr/local/netdisco && make doc

  11. Discover a Device in Netdisco

    Pick a device that you can access with the command "snmpwalk". Tell
    Netdisco to discover that device:

        cd /usr/local/netdisco
        ./netdisco -d devicename

    Make sure that this step actually works. This is a good metric that you
    have now installed Netdisco correctly. Add the *-D* flag to get copious
    debugging info.

  12. Create Network Topology

    See README for a description of *Topology Information*.

    If your network is CDP aware, pick a device that you consider close to
    the center of the network and start an autodiscovery from there:

        cd /usr/local/netdisco
        ./netdisco -r device_name_or_ip_number_here

  13. Test Web Side

    Point a browser to */netdisco* on the server you have Netdisco installed
    on. If everything is working you should be able to login with the
    username and password you added in Step 10. You should also be able to
    access the Admin Panel.

  14. Add Cron Jobs

    Once you're sure Netdisco is setup correctly add the Cron jobs listed in
    netdisco.crontab.

        su - -c "cron -u netdisco /usr/local/netdisco/netdisco.crontab"

    You may want to fine-tune these jobs to your network.

  15. Start Admin Daemon

    The admin deaemon performs administration jobs that are requested from
    the web front-end. See README for a description of the admin daemon.

        su - netdisco -c "/usr/local/netdisco/netdisco -p start"

